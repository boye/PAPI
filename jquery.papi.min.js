/*!
 * PAPI 0.4.0 (2013-08-29, 09:23)
 * https://github.com/boye/PAPI
 * MIT licensed
 *
 * Copyright (C) 2013 Boye Oomens, http://jussay.in/
 */
(function(e,t,i){"use strict";function r(e){"string"==typeof e&&(e=JSON.parse(e)),e.hasOwnProperty("success")&&e.hasOwnProperty("resource")&&o(e)}function o(t,i){t.success&&(i||e.papi.cache.setItem(e.papi.activeZipcode,JSON.stringify(t.resource)),e.papi._ok.apply(e.papi,[t.resource]))}function n(t){var i;switch(t.status){case 401:i="authorization required, please check your api-key";break;case 404:i="no additional data found";break;case 500:i="server error, shit has hit the fan yo! Contact @postcodeapi"}if(404!==t.status||!e.papi._notfound)throw Error("PAPI error: "+i);e.papi._notfound.apply(e.papi,[t])}var s="papi",a={event:"change",source:null,placeholders:{},bag:!1},c={type:"GET",dataType:"json",crossDomain:!0},u="^[1-9][0-9]{3} ?[a-zA-Z]{2}$",p=["latitude","longitude","municipality","postcode","province","street","town","house_number","x","y","bag"],h="http://api.postcodeapi.nu/",l="?view=bag";e.papi={_ok:null,_notfound:null,apiKey:null,proxyUrl:null,cache:function(){var e,i,r=new Date;try{return(e=t.localStorage).setItem(r,r),i=e.getItem(r)==r,e.removeItem(r),i&&e}catch(o){}}(),isCached:function(e){return this.cache.getItem(e)},activeZipcode:null,setApiKey:function(t){if(!t||t.constructor!==String)throw Error("PAPI error: no valid api-key given");return this.apiKey=t,e.extend(c,{beforeSend:function(e){e.setRequestHeader("Api-Key",t)}}),e.support.cors=!0,e.ajaxSetup(c),this},proxy:function(e){return e&&"string"==typeof e&&(this.proxyUrl=e),this},lookup:function(t,i,o){var s=t.replace(/\s+/g,""),a=h+[t,i].join("/")+(o?"/"+l:"");return this.activeZipcode=s,this.isCached(s)?this:s&&this.isValidZipcode(s)?(this.proxyUrl&&(a=this.proxyUrl+"?"+e.param({zipcode:s,houseNr:i,bag:o,apikey:this.apiKey})),e.ajax({url:a}).success(r).error(n),this):this},ok:function(t){return t&&e.isFunction(t)&&(this._ok=t,this.isCached(this.activeZipcode)&&o({success:!0,resource:JSON.parse(this.cache.getItem(this.activeZipcode))},!0)),this},notfound:function(t){return t&&e.isFunction(t)&&(this._notfound=t),this},setValue:function(e,t){return t?("input"===t.nodeName.toLowerCase()&&(t.value=JSON.parse(this.cache.getItem(this.activeZipcode))[e]),this):this},setValues:function(e){for(var t=p.length;t--;)e.hasOwnProperty(p[t])&&this.setValue(p[t],e[p[t]]);return this},isValidZipcode:function(e){return RegExp(u).test(e)}},e.fn[s]=function(t){var r=this;return r.each(function(){var o=e.extend({},a,t);if(!e.papi.apiKey)throw Error("PAPI error: no valid api-key given");e(i).on(o.event,r.selector,function(){var t,i=this.value;o.source&&(i=o.source.constructor===HTMLInputElement?o.source.value:e(o.source).val(),t=this.value),e.papi.lookup(i,t,o.bag).ok(function(){this.setValues(o.placeholders)})})})}})(jQuery,window,document);