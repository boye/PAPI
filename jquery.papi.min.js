/*!
 * PAPI 0.1.0 (2013-08-04, 21:49)
 * https://github.com/boye/PAPI
 * MIT licensed
 *
 * Copyright (C) 2013 Boye Oomens, http://jussay.in/
 */
(function(e,t,i){"use strict";function o(e){e.hasOwnProperty("success")&&e.hasOwnProperty("resource")&&n(e)}function n(t){t.success&&(e.papi.cache[e.papi.activeZipcode]=t.resource,e.papi._ok.apply(e.papi,[t.resource]))}function a(t){var i;switch(t.status){case 401:i="authorization required, please check your api-key";break;case 404:i="no additional data found",e.papi._notfound.apply(e.papi,[t]);break;case 500:i="server error, shit has hit the fan yo! Contact @postcodeapi"}throw Error("PAPI error: "+i)}var r="papi",s={bag:!1,event:null,source:null,placeholders:{}},p={type:"GET",dataType:"json"},u="^[1-9][0-9]{3} ?[a-zA-Z]{2}$",c=["latitude","longitude","municipality","postcode","province","street","town","house_number","x","y","bag"],h="http://api.postcodeapi.nu/",l="?view=bag";e.papi={_apiCalls:[],_ok:e.noop,_notfound:e.noop,apiKey:null,cache:{},activeZipcode:null,setApiKey:function(t){if(!t||t.constructor!==String)throw Error("PAPI error: no valid api-key given");return this.apiKey=t,e.extend(p,{beforeSend:function(e){e.setRequestHeader("Api-Key",t)}}),e.ajaxSetup(p),this},lookup:function(t,i,n){return this.cache.hasOwnProperty(t)?(e.papi._ok.apply(e.papi,[this.cache[t]]),this):(t=t.replace(/\s+/g,""),this._apiCalls.push(t),this.activeZipcode=t,t&&this.isValidZipcode(t)?(e.ajax({url:h+[t,i].join("/")+(n?"/"+l:"")}).success(o).error(a),this):this)},ok:function(t){return t&&e.isFunction(t)&&(this._ok=t),this},notfound:function(t){return t&&e.isFunction(t)&&(this._notfound=t),this},setValue:function(e,t){return t?("input"===t.nodeName.toLowerCase()&&(t.value=this.cache[this.activeZipcode][e]),this):this},setValues:function(e){for(var t=c.length;t--;)e.hasOwnProperty(c[t])&&this.setValue(c[t],e[c[t]]);return this},isValidZipcode:function(e){return RegExp(u).test(e)}},e.fn[r]=function(t){var o=this;return o.each(function(){var n=e.extend({},s,t);if("string"!=typeof e.papi.apiKey||!e.papi.apiKey.length)throw Error("PAPI error: no valid api-key given");e(i).on(n.event,o.selector,function(){var t,i=this.value;n.source&&(i=n.source.constructor===HTMLInputElement?n.source.value:e(n.source).val(),t=this.value),e.papi.lookup(i,t,n.bag).ok(function(){this.setValues(n.placeholders)})})})}})(jQuery,window,document);