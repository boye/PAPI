/*!
 * PAPI 0.2.0 (2013-08-05, 15:40)
 * https://github.com/boye/PAPI
 * MIT licensed
 *
 * Copyright (C) 2013 Boye Oomens, http://jussay.in/
 */
(function(e,t,i){"use strict";function o(e){e.hasOwnProperty("success")&&e.hasOwnProperty("resource")&&r(e)}function r(t,i){t.success&&(i||e.papi.cache.setItem(e.papi.activeZipcode,JSON.stringify(t.resource)),e.papi._ok.apply(e.papi,[t.resource]))}function n(t){var i;switch(t.status){case 0:i="you're probably using IE right? Well, unfortunately, that's not gonna work. You'll at least need IE10";break;case 401:i="authorization required, please check your api-key";break;case 404:i="no additional data found",e.papi._notfound.apply(e.papi,[t]);break;case 500:i="server error, shit has hit the fan yo! Contact @postcodeapi"}throw Error("PAPI error: "+i)}var a="papi",s={bag:!1,event:null,source:null,placeholders:{}},c={type:"GET",dataType:"json",crossDomain:!0},u="^[1-9][0-9]{3} ?[a-zA-Z]{2}$",p=["latitude","longitude","municipality","postcode","province","street","town","house_number","x","y","bag"],h="http://api.postcodeapi.nu/",l="?view=bag";e.papi={_ok:e.noop,_notfound:e.noop,apiKey:null,cache:function(){var e,i,o=new Date;try{return(e=t.localStorage).setItem(o,o),i=e.getItem(o)==o,e.removeItem(o),i&&e}catch(r){}}(),isCached:function(e){return this.cache.getItem(e)},activeZipcode:null,setApiKey:function(t){if(!t||t.constructor!==String)throw Error("PAPI error: no valid api-key given");return this.apiKey=t,e.support.cors=!0,e.extend(c,{beforeSend:function(e){e.setRequestHeader("Api-Key",t)}}),e.ajaxSetup(c),this},lookup:function(t,i,r){return t=t.replace(/\s+/g,""),this.activeZipcode=t,this.isCached(t)?this:t&&this.isValidZipcode(t)?(e.ajax({url:h+[t,i].join("/")+(r?"/"+l:"")}).success(o).error(n),this):this},ok:function(t){return t&&e.isFunction(t)&&(this._ok=t,this.isCached(this.activeZipcode)&&r({success:!0,resource:JSON.parse(this.cache.getItem(this.activeZipcode))},!0)),this},notfound:function(t){return t&&e.isFunction(t)&&(this._notfound=t),this},setValue:function(e,t){return t?("input"===t.nodeName.toLowerCase()&&(t.value=JSON.parse(this.cache.getItem(this.activeZipcode))[e]),this):this},setValues:function(e){for(var t=p.length;t--;)e.hasOwnProperty(p[t])&&this.setValue(p[t],e[p[t]]);return this},isValidZipcode:function(e){return RegExp(u).test(e)}},e.fn[a]=function(t){var o=this;return o.each(function(){var r=e.extend({},s,t);if("string"!=typeof e.papi.apiKey||!e.papi.apiKey.length)throw Error("PAPI error: no valid api-key given");e(i).on(r.event,o.selector,function(){var t,i=this.value;r.source&&(i=r.source.constructor===HTMLInputElement?r.source.value:e(r.source).val(),t=this.value),e.papi.lookup(i,t,r.bag).ok(function(){this.setValues(r.placeholders)})})})}})(jQuery,window,document);